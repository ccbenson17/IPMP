<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: widgets/Geoprocessing/Widget.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: widgets/Geoprocessing/Widget.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>///////////////////////////////////////////////////////////////////////////
// Copyright Â© Esri. All Rights Reserved.
//
// Licensed under the Apache License Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//    http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
///////////////////////////////////////////////////////////////////////////

/**
 * @fileoverview
 * Geoprocessing Widget creates a frontend interface to a given geoprocessing service. For example, the current implementation in the web app handles the DownloadData geoprocessing service: allowing the user to select an area of data to download. ({@link module:Geoprocessing|More info})
 */
define([
	'dojo/_base/declare',
	'dojo/_base/lang',
	'dojo/_base/array',
	'dojo/_base/html',
	'dojo/on',
	'dojo/query',
	'dojo/Deferred',
	'dojo/promise/all',
	'jimu/BaseWidget',
	'jimu/dijit/TabContainer',
	'jimu/dijit/LoadingIndicator',
	'jimu/dijit/Message',
	'jimu/utils',
	'jimu/zoomToUtils',
	'jimu/LayerInfos/LayerInfos',
	'./editorManager',
	'./resultRendererManager',
	'esri/tasks/GPMessage',
	'esri/tasks/Geoprocessor',
	'esri/tasks/JobInfo',
	'esri/layers/ImageParameters',
	'esri/request',
	'./utils',
], function (
	declare,
	lang,
	array,
	html,
	on,
	query,
	Deferred,
	all,
	BaseWidget,
	TabContainer,
	LoadingIndicator,
	Message,
	utils,
	zoomToUtils,
	LayerInfos,
	editorManager,
	resultRendererManager,
	GPMessage,
	Geoprocessor,
	JobInfo,
	ImageParameters,
	esriRequest,
	gputils
) {
	/**
	 * @module Geoprocessing
	 */
	var clazz = declare([BaseWidget], {
		//these two properties is defined in the BaseWidget
		baseClass: 'jimu-widget-geoprocessing',
		name: 'Geoprocessing',
		messageInterval: null,
		jodId: '',

		postMixInProperties: function () {
			this.inherited(arguments);
			lang.mixin(this.nls, window.jimuNls.common);
			lang.mixin(this.nls, window.jimuNls.units);
		},

		startup: function () {
			this.inherited(arguments);

			if (!this.config.taskUrl) {
				html.setStyle(this.toolNode, 'display', 'none');
				html.setStyle(this.errorNode, 'display', '');
				return;
			}
			this.inputNodes = [];
			this.drawTools = [];

			//each result will be displayed by dijit
			this.resultNodes = [];
			this.resultLayers = [];
			this.resultExtentMap = {};
			this.visibleOutputNames = [];
			if (this.config.useResultMapServer) {
				/*
        https://enterprise.arcgis.com/en/server/10.3/publish-services/linux/result-map-service.htm
        A Result Map Service will contain a layer for all geodataset output parameters such as GPFeatureRecordsetLayer,
        GPRasterDataLayer and GPRecordSet. Scalar outputs such as GPDate, GPDouble, GPLong, GPBoolean, GPDataFile,
        and GPLinearUnit cannot be represented as a map and no layer will be returned for these parameters.
        */
				array.some(
					this.config.outputParams,
					lang.hitch(this, function (param) {
						if (!param.ignore &amp;&amp; !param.layerInvisible &amp;&amp; param.dataType === 'MapServiceLayer') {
							this.visibleOutputNames.push(param.name);
							return true;
						}
					})
				);
			} else {
				array.forEach(
					this.config.outputParams,
					lang.hitch(this, function (param) {
						if (!param.ignore &amp;&amp; !param.layerInvisible &amp;&amp; param.dataType === 'GPFeatureRecordSetLayer') {
							this.visibleOutputNames.push(param.name);
						}
					})
				);
			}

			editorManager.setMap(this.map);
			editorManager.setNls(this.nls);

			resultRendererManager.setMap(this.map);
			resultRendererManager.setNls(this.nls);

			this.gp = new Geoprocessor(this.config.taskUrl);
			this.gp.setOutSpatialReference(this.map.spatialReference);

			if (this.config.updateDelay) {
				this.gp.setUpdateDelay(this.config.updateDelay);
			}

			this.tab = new TabContainer({
				tabs: [
					{
						title: this.nls.input,
						content: this.inputPaneNode,
					},
					{
						title: this.nls.output,
						content: this.outputPaneNode,
					},
				],
				selected: this.nls.input,
			});
			this.tab.placeAt(this.domNode);
			this.tab.startup();

			this.loading = new LoadingIndicator(
				{
					hidden: true,
				},
				this.loadingNode
			);
			this.loading.startup();

			//Fires when a synchronous GP task is completed
			this.own(on(this.gp, 'execute-complete', lang.hitch(this, this.onExecuteComplete)));

			//Fires when an asynchronous GP task using submitJob is complete.
			this.own(on(this.gp, 'job-complete', lang.hitch(this, this.onJobComplete)));

			this.own(on(this.gp, 'job-cancel', lang.hitch(this, this.onJonCancel)));

			//Fires when a job status update is available.
			this.own(on(this.gp, 'status-update', lang.hitch(this, this.onStatusUpdate)));

			//Fires when the result of an asynchronous GP task execution is available.
			this.own(on(this.gp, 'get-result-data-complete', lang.hitch(this, this.onGetResultDataComplate)));

			//Fires when a map image is generated by invoking the getResultImage method.
			this.own(on(this.gp, 'get-result-image-layer-complete', lang.hitch(this, this.onGetResultImageLayerComplete)));

			this.own(on(this.gp, 'error', lang.hitch(this, this.onError)));

			html.setAttr(this.helpLinkNode, 'href', this.config.helpUrl);

			this._generateUniqueID();
			if (!('serverInfo' in this.config)) {
				//Load gp server info if it does not exist.
				gputils.getServiceDescription(this.config.taskUrl).then(
					lang.hitch(this, function (taskInfo) {
						this.config.serverInfo = taskInfo.serverInfo;
						this._createInputNodes();
					})
				);
			} else {
				this._createInputNodes();
			}
		},

		executeGP: function () {
			this._clearLastResult();
			html.addClass(this.exeNode, 'jimu-state-disabled');
			this._getInputParamValues().then(
				lang.hitch(this, function (inputValues) {
					this._showLoading();

					// Send a request to service url to make it added to corsEnabledServers.
					esriRequest({
						url: `https://ipmp.ctre.iastate.edu/arcgis/rest/`,
						content: {
							f: 'json',
						},
						handleAs: 'json',
						callbackParamName: 'callback',
					}).then(
						lang.hitch(this, function () {
							if (this.config.isSynchronous) {
								this.gp.execute(inputValues);
								this.infoTextNode.innerHTML = this.nls.executing;
							} else {
								this.gp.submitJob(inputValues);
							}
							this.tab.selectTab(this.nls.output);
						}),
						lang.hitch(this, function () {
							html.removeClass(this.exeNode, 'jimu-state-disabled');
						})
					);
				}),
				lang.hitch(this, function () {
					html.removeClass(this.exeNode, 'jimu-state-disabled');
				})
			);
		},

		onDeActive: function () {
			array.forEach(this.drawTools, function (drawTool) {
				drawTool.deactivate();
			});
		},

		onExecuteComplete: function (results) {
			this._hideLoading();

			//show messages if there are warning or error
			var msgs;
			if (results.messages &amp;&amp; results.messages.length > 0) {
				msgs = array.filter(results.messages, function (msg) {
					return msg.type === GPMessage.TYPE_WARNING || msg.type === GPMessage.TYPE_ERROR;
				});
				if (msgs.length > 0) {
					this._createErrorMessages(msgs);
				}
			}

			//the results.results is an array of ParameterValue,
			//because it contains one or more parameters
			this._createOutputNodes(results.results);

			html.removeClass(this.exeNode, 'jimu-state-disabled');
		},

		onJobComplete: function (jobInfo) {
			this._hideLoading();
			this._clearMessageInterval();

			html.removeClass(this.exeNode, 'jimu-state-disabled');

			//onJobComplete is invoked even if jobStatus is STATUS_FAILED.
			//It hides this.infoNode so user can not see the error message!
			if (jobInfo.jobInfo.jobStatus !== JobInfo.STATUS_SUCCEEDED) {
				this._createErrorMessages(jobInfo.jobInfo.messages);
				return;
			}

			this._createOutputPlaceholders();

			if (this.config.useResultMapServer) {
				//only when GP task is async and the GP service publish the result map service,
				//the option "useResultMapServer" may be true. This will be guaranteed in builder
				var imageParameters = new ImageParameters({
					imageSpatialReference: this.map.spatialReference,
				});
				var resultMapServiceParam = this._getResultMapServiceParam();
				if (this.visibleOutputNames.indexOf(resultMapServiceParam.name) >= 0) {
					this.gp.getResultImageLayer(jobInfo.jobInfo.jobId, null, imageParameters);
				}
				// add outputs whose type is not geo dataset
				array.forEach(
					this.config.outputParams,
					function (param) {
						if (param.ignore !== true &amp;&amp; param.dataType !== 'GPFeatureRecordSetLayer' &amp;&amp; param.dataType !== 'GPRasterDataLayer' &amp;&amp; param.dataType !== 'GPRecordSet') {
							this.gp.getResultData(jobInfo.jobInfo.jobId, param.name);
						}
					},
					this
				);
			} else {
				array.forEach(
					this.config.outputParams,
					function (param) {
						if (param.ignore !== true) {
							this.gp.getResultData(jobInfo.jobInfo.jobId, param.name);
						}
					},
					this
				);
			}
		},

		onJonCancel: function () {
			this.loading.hide();
			this.infoTextNode.innerHTML = 'Canceled';

			html.removeClass(this.exeNode, 'jimu-state-disabled');
			this._clearMessageInterval();
		},

		onStatusUpdate: function (jobInfo) {
			this.jobId = jobInfo.jobInfo.jobId;
			if (jobInfo.jobInfo.jobStatus === JobInfo.STATUS_SUCCEEDED) {
				this._hideLoading();
				this._clearMessageInterval();
			} else {
				this._showLoading(jobInfo.jobInfo.jobStatus);
			}
			if (!this.messageInterval &amp;&amp; this.jobId) {
				this._setupMessageInterval();
			}
		},

		onGetResultDataComplate: function (result) {
			//the result.result contains only one ParameterValue
			this._updateOutputNode(this._getOutputParamByName(result.result.paramName), result.result);
		},

		onGetResultImageLayerComplete: function (result) {
			var lyr = result.layer;
			if (lyr) {
				var layerName = lyr.url.substring(lyr.url.lastIndexOf('/') + 1);
				var outputParam = {
					name: layerName,
					title: layerName,
					tooltip: layerName,
					dataType: 'MapServiceLayer',
				};
				lyr._wab_type = 'ArcGISDynamicMapServiceLayer';
				var resultMapServiceParam = this._getResultMapServiceParam();
				if (resultMapServiceParam) {
					outputParam.label = resultMapServiceParam.label;
					outputParam.tooltip = resultMapServiceParam.tooltip;
					outputParam.layerInvisible = resultMapServiceParam.layerInvisible;
					lyr.title = resultMapServiceParam.label;
					lyr.setVisibility(resultMapServiceParam.layerInvisible !== true);
				}
				var outputNode = this._updateOutputNode(outputParam, lyr);

				if (outputNode !== null) {
					this.resultLayers.push(lyr);
					var layerInfos = LayerInfos.getInstanceSync();
					var addLayerHandle = on(
						layerInfos,
						'layerInfosChanged',
						lang.hitch(this, function () {
							var layerInfo = layerInfos.getLayerInfoById(lyr.id);
							if (layerInfo) {
								addLayerHandle.remove();
								if (!outputParam.label) {
									var labelNode = query('.output-label', outputNode);
									if (labelNode &amp;&amp; labelNode.length > 0 &amp;&amp; layerInfo.title) {
										labelNode[0].innerHTML = layerInfo.title;
									}
								}
								layerInfo.getExtent().then(
									lang.hitch(this, function (ext) {
										if (lang.isArray(ext) &amp;&amp; ext.length > 0) {
											this.resultExtentMap[resultMapServiceParam.name] = ext[0];
											this._updateResultExtent();
										} else if (ext) {
											this.resultExtentMap[resultMapServiceParam.name] = ext;
											this._updateResultExtent();
										}
									})
								);
							}
						})
					);
				}
			}
		},

		onError: function (error) {
			this.loading.hide();
			html.empty(this.infoTextNode);
			html.create(
				'div',
				{
					class: 'job-message error',
					innerHTML: utils.sanitizeHTML(error.error.message),
				},
				this.infoTextNode
			);

			html.removeClass(this.exeNode, 'jimu-state-disabled');
			this._clearMessageInterval();
		},

		_updateJobMessage: function () {
			// Send request to get job messages
			esriRequest({
				url: this.config.taskUrl + '/jobs/' + this.jobId,
				content: {
					f: 'json',
					returnMessages: true,
				},
				handleAs: 'json',
				callbackParamName: 'callback',
			}).then(
				lang.hitch(this, function (res) {
					if (res.messages &amp;&amp; res.messages.length > 0) {
						html.empty(this.infoTextNode);
						array.forEach(
							res.messages,
							function (message) {
								var msgType = 'normal';
								if (message.type === GPMessage.TYPE_WARNING) {
									msgType = 'warning';
								} else if (message.type === GPMessage.TYPE_ERROR) {
									msgType = 'error';
								}
								html.create(
									'div',
									{
										class: 'job-message ' + msgType,
										innerHTML: utils.sanitizeHTML(message.description),
									},
									this.infoTextNode
								);
							},
							this
						);
					}
				})
			);
		},

		_setupMessageInterval: function () {
			this.messageInterval = setInterval(lang.hitch(this, this._updateJobMessage), 3000);
		},

		_clearMessageInterval: function () {
			this.jobId = '';
			if (this.messageInterval) {
				clearInterval(this.messageInterval);
				this.messageInterval = null;
			}
		},

		destroy: function () {
			this._clearLastInput();
			this._clearLastResult();
			this._clearMessageInterval();
			this.inherited(arguments);
		},

		_generateUniqueID: function () {
			this.uniqueID = this.id.replace(/[\/\.]/g, '_');
		},

		_showLoading: function () {
			this.loading.show();
			html.setStyle(this.infoNode, 'display', 'block');
		},

		_hideLoading: function () {
			html.setStyle(this.infoNode, 'display', 'none');
			this.loading.hide();
		},

		_getOutputParamByName: function (paramName) {
			for (var i = 0; i &lt; this.config.outputParams.length; i++) {
				if (this.config.outputParams[i].name === paramName) {
					return this.config.outputParams[i];
				}
			}
		},

		_getInputParamValues: function () {
			var retDef = new Deferred(),
				retValues = {},
				defs = [],
				def,
				errorMessage = '';
			array.forEach(
				this.inputNodes,
				function (node) {
					def = node.inputEditor.getGPValue();
					def.param = node.param;
					defs.push(def);
				},
				this
			);

			all(defs).then(
				lang.hitch(this, function (values) {
					for (var i = 0; i &lt; values.length; i++) {
						if (defs[i].param.required &amp;&amp; (values[i] === null || values[i] === undefined)) {
							errorMessage = defs[i].param.label + ' ' + this.nls.requiredInfo;
							new Message({
								message: errorMessage,
							});
							retDef.reject(errorMessage);
							return;
						} else {
							retValues[defs[i].param.name] = values[i];
						}
					}
					retDef.resolve(retValues);
				}),
				function (err) {
					retDef.reject(err);
				}
			);
			return retDef;
		},

		_createInputNodes: function () {
			array.forEach(
				this.config.inputParams,
				function (param) {
					this._createInputNode(param);
				},
				this
			);
		},

		_clearLastInput: function () {
			array.forEach(
				this.inputNodes,
				function (node) {
					if (node.inputEditor.clear &amp;&amp; lang.isFunction(node.inputEditor.clear)) {
						node.inputEditor.clear();
					}
				},
				this
			);
		},

		_clearLastResult: function () {
			html.empty(this.infoTextNode);
			array.forEach(this.resultNodes, function (node) {
				html.destroy(node.labelNode);
				if (node.resultRenderer) {
					node.resultRenderer.destroy();
				}
				html.destroy(node);
			});
			array.forEach(
				this.resultLayers,
				function (layer) {
					if (layer !== null) {
						this.map.removeLayer(layer);
					}
				},
				this
			);

			this.resultNodes = [];
			this.resultLayers = [];
			this.resultExtentMap = {};
		},

		_createErrorMessages: function (messages) {
			this.infoTextNode.innerHTML = '';

			var ulNode = html.create(
				'ul',
				{
					class: 'output-node',
				},
				this.outputSectionNode
			);

			this.resultNodes.push(ulNode);

			array.forEach(
				messages,
				lang.hitch(this, function (msg) {
					var msgType = 'normal';
					if (msg.type === GPMessage.TYPE_WARNING) {
						msgType = 'warning';
					} else if (msg.type === GPMessage.TYPE_ERROR) {
						msgType = 'error';
					}
					html.create(
						'li',
						{
							class: 'job-message ' + msgType,
							innerHTML: utils.sanitizeHTML(msg.description),
						},
						ulNode
					);
				})
			);
		},

		_createOutputNodes: function (values) {
			var nodes = [];
			array.forEach(
				this.config.outputParams,
				function (param, i) {
					nodes.push(this._createOutputNode(param, values[i]));
				},
				this
			);

			var hasVisibleParam = array.some(nodes, function (node) {
				return node !== null;
			});

			if (hasVisibleParam) {
				var allFeatures = [];
				array.forEach(
					values,
					lang.hitch(this, function (valueObj) {
						if (valueObj.dataType === 'GPFeatureRecordSetLayer') {
							var features = valueObj.value &amp;&amp; valueObj.value.features;
							if (features &amp;&amp; features.length > 0) {
								allFeatures = allFeatures.concat(features);
							}
						}
					})
				);
				if (allFeatures.length > 0) {
					utils.featureAction.zoomTo(this.map, allFeatures);
				}
			}
		},

		_onExecuteClick: function () {
			if (html.hasClass(this.exeNode, 'jimu-state-disabled')) {
				return;
			}
			this.executeGP();
		},

		_createInputNode: function (param) {
			var node = html.create(
				'div',
				{
					class: 'input-node',
				},
				this.inputSectionNode
			);
			var labelNode = html.create(
				'div',
				{
					class: 'input-label',
					title: param.tooltip || param.label || '',
				},
				node
			);
			html.create(
				'span',
				{
					class: 'label-text',
					innerHTML: utils.sanitizeHTML(param.label),
				},
				labelNode
			);
			if (param.required) {
				html.create(
					'span',
					{
						class: 'label-star',
						innerHTML: '*',
					},
					labelNode
				);
			}

			var editorContainerNode = html.create(
				'div',
				{
					class: 'editor-container',
				},
				node
			);

			var inputEditor = editorManager.createEditor(param, 'input', 'widget', {
				uid: this.uniqueID,
				config: this.config,
				appConfig: this.appConfig,
			});
			inputEditor.placeAt(editorContainerNode);

			if (inputEditor.editorName === 'SelectFeatureSetFromDraw') {
				this.drawTools.push(inputEditor.drawBox);
			}

			node.param = param;
			node.inputEditor = inputEditor;
			this.inputNodes.push(node);

			if (param.visible === false) {
				html.setStyle(node, 'display', 'none');
			}
			return node;
		},

		_updateOutputNode: function (param, value) {
			var node, resultRenderer;
			array.some(
				this.resultNodes,
				lang.hitch(this, function (resultNode) {
					if (
						(param.dataType !== 'MapServiceLayer' &amp;&amp; resultNode.param.name === param.name) ||
						(param.dataType === 'MapServiceLayer' &amp;&amp; resultNode.param.dataType === 'MapServiceLayer')
					) {
						node = resultNode;
						return true;
					}
				})
			);
			if (!node) {
				return null;
			}
			try {
				resultRenderer = resultRendererManager.createResultRenderer(param, value, {
					uid: this.uniqueID,
					config: this.config,
				});
				if (param.dataType === 'GPFeatureRecordSetLayer') {
					if (resultRenderer.resultLayer &amp;&amp; resultRenderer.resultLayer.fullExtent) {
						this.resultExtentMap[param.name] = resultRenderer.resultLayer.fullExtent;
					} else {
						this.resultExtentMap[param.name] = 'empty';
					}
					this._updateResultExtent();
				}
			} catch (err) {
				console.error(err);
				resultRenderer = resultRendererManager.createResultRenderer('error', value, {
					uid: this.uniqueID,
					config: this.config,
				});
			}

			html.empty(node.placeholderNode);
			resultRenderer.placeAt(node.placeholderNode);
			resultRenderer.startup();
			node.resultRenderer = resultRenderer;

			// update datasource
			if (
				!this.config.useResultMapServer &amp;&amp;
				(param.dataType === 'GPFeatureRecordSetLayer' || param.dataType === 'GPRecordSet') &amp;&amp;
				param.defaultValue &amp;&amp;
				param.defaultValue.fields
			) {
				if (!gputils.useDynamicSchema(param, this.config)) {
					this.updateDataSourceData('filter-' + param.name, {
						features: value.value.features,
					});
				}
			}
			return node;
		},

		_createOutputPlaceholders: function () {
			array.forEach(
				this.config.outputParams,
				function (param) {
					if (!this.config.useResultMapServer &amp;&amp; param.dataType === 'MapServiceLayer') {
						// should not include result map service if it's not enabled
						return;
					}
					if (this.config.useResultMapServer &amp;&amp; (param.dataType === 'GPFeatureRecordSetLayer' || param.dataType === 'GPRasterDataLayer' || param.dataType === 'GPRecordSet')) {
						// already included in result map service
						return;
					}
					if (param.ignore !== true) {
						var node = html.create(
							'div',
							{
								class: 'output-node',
							},
							this.outputSectionNode
						);

						var labelNode = html.create(
							'div',
							{
								class: 'output-label',
								title: param.tooltip || param.label || '',
								innerHTML: utils.sanitizeHTML(param.label),
							},
							node
						);

						var placeholderNode = html.create(
							'div',
							{
								class: 'renderer-container',
								innerHTML: '&lt;div class="output-loading">&lt;/div>',
							},
							node
						);

						node.param = param;
						node.labelNode = labelNode;
						node.placeholderNode = placeholderNode;

						this.resultNodes.push(node);
					}
				},
				this
			);
		},

		_createOutputNode: function (param, value) {
			var resultRenderer;

			if (param.ignore !== true) {
				try {
					resultRenderer = resultRendererManager.createResultRenderer(param, value, {
						uid: this.uniqueID,
						config: this.config,
					});
					if (param.dataType === 'GPFeatureRecordSetLayer') {
						if (resultRenderer.resultLayer &amp;&amp; resultRenderer.resultLayer.fullExtent) {
							this.resultExtentMap[param.name] = resultRenderer.resultLayer.fullExtent;
						} else {
							this.resultExtentMap[param.name] = 'empty';
						}
						this._updateResultExtent();
					}
				} catch (err) {
					console.error(err);
					resultRenderer = resultRendererManager.createResultRenderer('error', value, {
						uid: this.uniqueID,
						config: this.config,
					});
				}

				var node = html.create(
					'div',
					{
						class: 'output-node',
					},
					this.outputSectionNode
				);

				this.resultNodes.push(node);

				var labelNode = html.create(
					'div',
					{
						class: 'output-label',
						title: param.tooltip || param.label || '',
						innerHTML: utils.sanitizeHTML(param.label),
					},
					node
				);

				node.param = param;
				node.labelNode = labelNode;

				var rendererContainerNode = html.create(
					'div',
					{
						class: 'renderer-container',
					},
					node
				);

				resultRenderer.placeAt(rendererContainerNode);
				resultRenderer.startup();
				node.resultRenderer = resultRenderer;

				// update datasource
				if (
					!this.config.useResultMapServer &amp;&amp;
					(param.dataType === 'GPFeatureRecordSetLayer' || param.dataType === 'GPRecordSet') &amp;&amp;
					param.defaultValue &amp;&amp;
					param.defaultValue.fields
				) {
					if (!gputils.useDynamicSchema(param, this.config)) {
						this.updateDataSourceData('filter-' + param.name, {
							features: value.value.features,
						});
					}
				}
				return node;
			} else {
				return null;
			}
		},

		_getResultMapServiceParam: function () {
			var resultMapServiceParam;
			array.some(this.config.outputParams, function (param) {
				if (param.dataType === 'MapServiceLayer') {
					resultMapServiceParam = param;
					return true;
				}
			});
			return resultMapServiceParam;
		},

		_updateResultExtent: function () {
			var allResultLoaded = array.every(
				this.visibleOutputNames,
				lang.hitch(this, function (paramName) {
					return this.resultExtentMap[paramName] !== undefined;
				})
			);
			if (allResultLoaded) {
				var extent;
				array.forEach(
					this.visibleOutputNames,
					lang.hitch(this, function (paramName) {
						if (this.resultExtentMap[paramName] !== 'empty') {
							if (!extent) {
								extent = this.resultExtentMap[paramName];
							} else {
								extent = extent.union(this.resultExtentMap[paramName]);
							}
						}
					})
				);
				if (extent) {
					zoomToUtils.zoomToExtent(this.map, extent);
				}
			}
		},

		/**
		 * Use selected feature set as input for GP
		 */
		useSelectionAsInput: function (featureSet, layer) {
			array.forEach(
				this.inputNodes,
				function (node) {
					if (
						node.param.dataType === 'GPFeatureRecordSetLayer' &amp;&amp;
						node.param.defaultValue &amp;&amp;
						utils.getTypeByGeometryType(node.param.defaultValue.geometryType) === featureSet.geometryType
					) {
						node.inputEditor.setFeatureSet(featureSet, layer);
					}
				},
				this
			);

			this.tab.selectTab(this.nls.input);
		},
	});

	return clazz;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="echarts_coord_scale_Ordinal%250D%250Dhttp___en.wikipedia.org_wiki_Level_of_measurementmodule_.html">echarts/coord/scale/Ordinalhttp://en.wikipedia.org/wiki/Level_of_measurement</a></li><li><a href="echarts-module_ECharts.html">ECharts</a></li><li><a href="echarts-module_MessageCenter.html">MessageCenter</a></li><li><a href="module-AttributeTable.html">AttributeTable</a></li><li><a href="module-BasemapGallery.html">BasemapGallery</a></li><li><a href="module-Draw.html">Draw</a></li><li><a href="module-echarts_animation_Animator.html">echarts/animation/Animator</a></li><li><a href="module-echarts_chart_helper_Line.html">echarts/chart/helper/Line</a></li><li><a href="module-echarts_chart_helper_LineDraw.html">echarts/chart/helper/LineDraw</a></li><li><a href="module-echarts_chart_helper_Symbol.html">echarts/chart/helper/Symbol</a></li><li><a href="module-echarts_chart_helper_SymbolDraw.html">echarts/chart/helper/SymbolDraw</a></li><li><a href="module-echarts_coord_Cartesian.html">echarts/coord/Cartesian</a></li><li><a href="module-echarts_coord_geo_parseGeoJson.html">echarts/coord/geo/parseGeoJson</a></li><li><a href="module-echarts_coord_geo_Region.html">echarts/coord/geo/Region</a></li><li><a href="module-echarts_core_BoundingRect.html">echarts/core/BoundingRect</a></li><li><a href="module-echarts_data_List.html">echarts/data/List</a></li><li><a href="module-echarts_model_Component.html">echarts/model/Component</a></li><li><a href="module-echarts_model_Model.html">echarts/model/Model</a></li><li><a href="module-echarts_scale_Interval.html">echarts/scale/Interval</a></li><li><a href="module-echarts_scale_Log.html">echarts/scale/Log</a></li><li><a href="module-echarts_scale_Scale.html">echarts/scale/Scale</a></li><li><a href="module-echarts_stream_Scheduler.html">echarts/stream/Scheduler</a></li><li><a href="module-Geoprocessing.html">Geoprocessing</a></li><li><a href="module-HomeButton.html">HomeButton</a></li><li><a href="module-Infographic.html">Infographic</a></li><li><a href="module-LayerList.html">LayerList</a></li><li><a href="module-MapProgress.html">MapProgress</a></li><li><a href="module-PickColumns.html">PickColumns</a></li><li><a href="module-Search.html">Search</a></li><li><a href="module-Select.html">Select</a></li><li><a href="module-Splash.html">Splash</a></li><li><a href="module-themes_LaunchpadTheme_widgets_AnchorBarController_BaseIconItem.html">themes/LaunchpadTheme/widgets/AnchorBarController/BaseIconItem</a></li><li><a href="module-themes_LaunchpadTheme_widgets_AnchorBarController_DockableItem.html">themes/LaunchpadTheme/widgets/AnchorBarController/DockableItem</a></li><li><a href="module-themes_LaunchpadTheme_widgets_AnchorBarController_GroupItems.html">themes/LaunchpadTheme/widgets/AnchorBarController/GroupItems</a></li><li><a href="module-themes_LaunchpadTheme_widgets_AnchorBarController_Widget.html">themes/LaunchpadTheme/widgets/AnchorBarController/Widget</a></li><li><a href="module-Treatment.html">Treatment</a></li><li><a href="module-widgets_Coordinate.html">widgets/Coordinate</a></li><li><a href="module-zrender_animation_Animation.html">zrender/animation/Animation</a></li><li><a href="module-zrender_animation_easing.html">zrender/animation/easing</a></li><li><a href="module-zrender_core_bbox.html">zrender/core/bbox</a></li><li><a href="module-zrender_core_curve.html">zrender/core/curve</a></li><li><a href="module-zrender_core_event.html">zrender/core/event</a></li><li><a href="module-zrender_core_PathProxy.html">zrender/core/PathProxy</a></li><li><a href="module-zrender_core_util.html">zrender/core/util</a></li><li><a href="module-zrender_graphic_Displayable.html">zrender/graphic/Displayable</a></li><li><a href="module-zrender_graphic_Group.html">zrender/graphic/Group</a></li><li><a href="module-zrender_graphic_shape_Arc.html">zrender/graphic/shape/Arc</a></li><li><a href="module-zrender_graphic_shape_Line.html">zrender/graphic/shape/Line</a></li><li><a href="module-zrender_graphic_shape_Polyline.html">zrender/graphic/shape/Polyline</a></li><li><a href="module-zrender_graphic_shape_Rect.html">zrender/graphic/shape/Rect</a></li><li><a href="module-zrender_graphic_shape_Ring.html">zrender/graphic/shape/Ring</a></li><li><a href="module-zrender_graphic_shape_Sector.html">zrender/graphic/shape/Sector</a></li><li><a href="module-zrender_Layer.html">zrender/Layer</a></li><li><a href="module-zrender_mixin_Eventful.html">zrender/mixin/Eventful</a></li><li><a href="module-zrender_mixin_RectText.html">zrender/mixin/RectText</a></li><li><a href="module-zrender_mixin_Transformable.html">zrender/mixin/Transformable</a></li><li><a href="module-zrender_shape_BezierCurve.html">zrender/shape/BezierCurve</a></li><li><a href="module-zrender_shape_Circle.html">zrender/shape/Circle</a></li><li><a href="module-zrender_shape_Polygon.html">zrender/shape/Polygon</a></li><li><a href="module-zrender_shape_util_smoothBezier.html">zrender/shape/util/smoothBezier</a></li><li><a href="module-zrender_shape_util_smoothSpline.html">zrender/shape/util/smoothSpline</a></li><li><a href="module-zrender_tool_matrix.html">zrender/tool/matrix</a></li><li><a href="module-zrender_ZRender.html">zrender/ZRender</a></li><li><a href="module-%257Becharts_model_Global%257D.html">{echarts/model/Global}</a></li><li><a href="module-%257Becharts_model_OptionManager%257D.html">{echarts/model/OptionManager}</a></li></ul><h3>Namespaces</h3><ul><li><a href="crc.html">crc</a></li><li><a href="LocalMediaStream%2520--%2520https___developer.mozilla.org_en-US_docs_WebRTC_MediaStream_API_LocalMediaStream.html">LocalMediaStream</a></li><li><a href="xhr.sendAsBinary%2520%2520https___developer.mozilla.org_ru_XMLHttpRequest_Sending_binary_content.html">Sending_binary_content</a></li></ul><h3>Classes</h3><ul><li><a href="FileAPI.Camera.html">Camera</a></li><li><a href="FileAPI.Camera.Shot.html">Shot</a></li><li><a href="modue_zrender_mixin_Animatable.html">modue:zrender/mixin/Animatable</a></li><li><a href="module-echarts_chart_helper_SymbolDraw.html">echarts/chart/helper/SymbolDraw</a></li><li><a href="module-echarts_component_marker_LineDraw.html">echarts/component/marker/LineDraw</a></li><li><a href="module-echarts_component_tooltip_TooltipContent.html">echarts/component/tooltip/TooltipContent</a></li><li><a href="module-echarts_coord_Cartesian.html">echarts/coord/Cartesian</a></li><li><a href="module-echarts_coord_Cartesian-module_echarts_coord_cartesian_Axis2D.html">echarts/coord/cartesian/Axis2D</a></li><li><a href="module-echarts_coord_scale_Interval.html">echarts/coord/scale/Interval</a></li><li><a href="module-echarts_coord_scale_Time.html">echarts/coord/scale/Time</a></li><li><a href="module-echarts_data_List.html">echarts/data/List</a></li><li><a href="module-echarts_model_Component.html">echarts/model/Component</a></li><li><a href="module-echarts_model_Model.html">echarts/model/Model</a></li><li><a href="module-zrender_animation_Animation.html">zrender/animation/Animation</a></li><li><a href="module-zrender_animation_Animator.html">zrender/animation/Animator</a></li><li><a href="module-zrender_core_LRU.html">zrender/core/LRU</a></li><li><a href="module-zrender_core_PathProxy.html">zrender/core/PathProxy</a></li><li><a href="module-zrender_Element.html">zrender/Element</a></li><li><a href="module-zrender_graphic_Group.html">zrender/graphic/Group</a></li><li><a href="module-zrender_graphic_Path.html">zrender/graphic/Path</a></li><li><a href="module-zrender_Handler.html">zrender/Handler</a></li><li><a href="module-zrender_Layer.html">zrender/Layer</a></li><li><a href="module-zrender_mixin_Eventful.html">zrender/mixin/Eventful</a></li><li><a href="module-zrender_mixin_Transformable.html">zrender/mixin/Transformable</a></li><li><a href="module-zrender_Painter.html">zrender/Painter</a></li><li><a href="module-zrender_Storage.html">zrender/Storage</a></li><li><a href="module-zrender_ZRender.html">zrender/ZRender</a></li><li><a href="zrender_graphic_Image.html">zrender/graphic/Image</a></li><li><a href="zrender_graphic_Text.html">zrender/graphic/Text</a></li><li>{<a href="module-echarts_chart_helper_Line.html">module:echarts/chart/helper/Line</a>}</li><li>{<a href="module-echarts_chart_helper_Symbol.html">module:echarts/chart/helper/Symbol</a>}</li></ul><h3>Events</h3><ul><li><a href="module-echarts_chart_helper_SymbolDraw.html#~event:legendScroll">legendScroll</a></li><li><a href="module-echarts_chart_helper_SymbolDraw.html#~event:legendSelect">legendSelect</a></li><li><a href="module-echarts_chart_helper_SymbolDraw.html#~event:legendToggleSelect">legendToggleSelect</a></li><li><a href="module-echarts_chart_helper_SymbolDraw.html#~event:legendUnSelect">legendUnSelect</a></li></ul><h3>Mixins</h3><ul><li><a href="module-echarts_chart_helper_LineDraw-%257Bmodule_zrender_mixin_Eventful%257D.html">{zrender/mixin/Eventful}</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_addExternalStyleSheets">_addExternalStyleSheets</a></li><li><a href="global.html#_addSectionTitle">_addSectionTitle</a></li><li><a href="global.html#_createLayout">_createLayout</a></li><li><a href="global.html#_createPrintMapParameters">_createPrintMapParameters</a></li><li><a href="global.html#_createPrintTask">_createPrintTask</a></li><li><a href="global.html#_createReportNote">_createReportNote</a></li><li><a href="global.html#_displayLayers">_displayLayers</a></li><li><a href="global.html#_executePrintTask">_executePrintTask</a></li><li><a href="global.html#_filters">_filters</a></li><li><a href="global.html#_findContentItemById">_findContentItemById</a></li><li><a href="global.html#_formatAndRenderTables">_formatAndRenderTables</a></li><li><a href="global.html#_getFixedThemeStyles">_getFixedThemeStyles</a></li><li><a href="global.html#_handleDataSourceForWidgets">_handleDataSourceForWidgets</a></li><li><a href="global.html#_onAppProxyForMapChanged">_onAppProxyForMapChanged</a></li><li><a href="global.html#_onAppProxyForUrlChanged">_onAppProxyForUrlChanged</a></li><li><a href="global.html#_onFieldVisibleChange">_onFieldVisibleChange</a></li><li><a href="global.html#_renderHTMLData">_renderHTMLData</a></li><li><a href="global.html#_renderTable">_renderTable</a></li><li><a href="global.html#_resetCoordinate">_resetCoordinate</a></li><li><a href="global.html#_setButtonLabels">_setButtonLabels</a></li><li><a href="global.html#_setCoordControlsTabindex">_setCoordControlsTabindex</a></li><li><a href="global.html#_setFootNotes">_setFootNotes</a></li><li><a href="global.html#_setPageSize">_setPageSize</a></li><li><a href="global.html#_setReportData">_setReportData</a></li><li><a href="global.html#_setReportLogo">_setReportLogo</a></li><li><a href="global.html#_setReportSizeMessage">_setReportSizeMessage</a></li><li><a href="global.html#_setReportTitle">_setReportTitle</a></li><li><a href="global.html#_updatePartForBetween">_updatePartForBetween</a></li><li><a href="global.html#_validateParameters">_validateParameters</a></li><li><a href="global.html#acceptValue">acceptValue</a></li><li><a href="global.html#action">action</a></li><li><a href="global.html#applyWidgetFilter">applyWidgetFilter</a></li><li><a href="global.html#calculateLayerIndex">calculateLayerIndex</a></li><li><a href="global.html#canAssignUsersToOrgGroups">canAssignUsersToOrgGroups</a></li><li><a href="global.html#canChangeUserRoles">canChangeUserRoles</a></li><li><a href="global.html#canCreateGroup">canCreateGroup</a></li><li><a href="global.html#canCreateItem">canCreateItem</a></li><li><a href="global.html#canDeleteOrgGroups">canDeleteOrgGroups</a></li><li><a href="global.html#canDeleteOrgItems">canDeleteOrgItems</a></li><li><a href="global.html#canDeleteUsers">canDeleteUsers</a></li><li><a href="global.html#canDesignateOpenDataGroups">canDesignateOpenDataGroups</a></li><li><a href="global.html#canDisableUsers">canDisableUsers</a></li><li><a href="global.html#canEditFeatures">canEditFeatures</a></li><li><a href="global.html#canEditFeaturesFullControl">canEditFeaturesFullControl</a></li><li><a href="global.html#canInviteUsers">canInviteUsers</a></li><li><a href="global.html#canJoinNonOrgGroup">canJoinNonOrgGroup</a></li><li><a href="global.html#canJoinOrgGroup">canJoinOrgGroup</a></li><li><a href="global.html#canManageEnterpriseGroups">canManageEnterpriseGroups</a></li><li><a href="global.html#canManageLicenses">canManageLicenses</a></li><li><a href="global.html#canManageMarketplace">canManageMarketplace</a></li><li><a href="global.html#canManageOpenData">canManageOpenData</a></li><li><a href="global.html#canPublishFeatures">canPublishFeatures</a></li><li><a href="global.html#canPublishScenes">canPublishScenes</a></li><li><a href="global.html#canPublishTiles">canPublishTiles</a></li><li><a href="global.html#canPurchaseMarketplace">canPurchaseMarketplace</a></li><li><a href="global.html#canReassignOrgGroups">canReassignOrgGroups</a></li><li><a href="global.html#canReassignOrgItems">canReassignOrgItems</a></li><li><a href="global.html#canShareGroupToOrg">canShareGroupToOrg</a></li><li><a href="global.html#canShareGroupToPublic">canShareGroupToPublic</a></li><li><a href="global.html#canShareItemToGroup">canShareItemToGroup</a></li><li><a href="global.html#canShareItemToOrg">canShareItemToOrg</a></li><li><a href="global.html#canShareItemToPublic">canShareItemToPublic</a></li><li><a href="global.html#canTrialMarketplace">canTrialMarketplace</a></li><li><a href="global.html#canUpdateOrgGroups">canUpdateOrgGroups</a></li><li><a href="global.html#canUpdateOrgItems">canUpdateOrgItems</a></li><li><a href="global.html#canUpdateUsers">canUpdateUsers</a></li><li><a href="global.html#canUseDemographics">canUseDemographics</a></li><li><a href="global.html#canUseElevation">canUseElevation</a></li><li><a href="global.html#canUseGeocode">canUseGeocode</a></li><li><a href="global.html#canUseGeoenrichment">canUseGeoenrichment</a></li><li><a href="global.html#canUseNetworkAnalysis">canUseNetworkAnalysis</a></li><li><a href="global.html#canUseSpatialAnalysis">canUseSpatialAnalysis</a></li><li><a href="global.html#canViewOrgGroups">canViewOrgGroups</a></li><li><a href="global.html#canViewOrgItems">canViewOrgItems</a></li><li><a href="global.html#canViewUsers">canViewUsers</a></li><li><a href="global.html#clear">clear</a></li><li><a href="global.html#constructor">constructor</a></li><li><a href="global.html#coordTextInputKeyWasPressed">coordTextInputKeyWasPressed</a></li><li><a href="global.html#cpBtnWasClicked">cpBtnWasClicked</a></li><li><a href="global.html#cpSubBtnWasClicked">cpSubBtnWasClicked</a></li><li><a href="global.html#createPages">createPages</a></li><li><a href="global.html#deactivateDrawTool">deactivateDrawTool</a></li><li><a href="global.html#destroyOnScreenWidgetsAndGroups">destroyOnScreenWidgetsAndGroups</a></li><li><a href="global.html#drawPointButtonWasClicked">drawPointButtonWasClicked</a></li><li><a href="global.html#expandButtonWasClicked">expandButtonWasClicked</a></li><li><a href="global.html#formatButtonWasClicked">formatButtonWasClicked</a></li><li><a href="global.html#formatDialogApplyButtonClicked">formatDialogApplyButtonClicked</a></li><li><a href="global.html#geomSrvcDidComplete">geomSrvcDidComplete</a></li><li><a href="global.html#geomSrvcDidFail">geomSrvcDidFail</a></li><li><a href="global.html#getCandidateParamNames">getCandidateParamNames</a></li><li><a href="global.html#getCleanInput">getCleanInput</a></li><li><a href="global.html#getCoordValues">getCoordValues</a></li><li><a href="global.html#getCurrentMapCoordinate">getCurrentMapCoordinate</a></li><li><a href="global.html#getDDPoint">getDDPoint</a></li><li><a href="global.html#getExportString">getExportString</a></li><li><a href="global.html#getFormattedCoordinates">getFormattedCoordinates</a></li><li><a href="global.html#getFormattedCoordinateText">getFormattedCoordinateText</a></li><li><a href="global.html#getFormattedDDMStr">getFormattedDDMStr</a></li><li><a href="global.html#getFormattedDDStr">getFormattedDDStr</a></li><li><a href="global.html#getFormattedDMSStr">getFormattedDMSStr</a></li><li><a href="global.html#getFormattedGARSStr">getFormattedGARSStr</a></li><li><a href="global.html#getFormattedGEOREFStr">getFormattedGEOREFStr</a></li><li><a href="global.html#getFormattedMGRSStr">getFormattedMGRSStr</a></li><li><a href="global.html#getFormattedUSNGStr">getFormattedUSNGStr</a></li><li><a href="global.html#getFormattedUTMHStr">getFormattedUTMHStr</a></li><li><a href="global.html#getFormattedUTMStr">getFormattedUTMStr</a></li><li><a href="global.html#getIcon">getIcon</a></li><li><a href="global.html#getMapCoordinateDD">getMapCoordinateDD</a></li><li><a href="global.html#getOrderableInput">getOrderableInput</a></li><li><a href="global.html#getOrderableOutput">getOrderableOutput</a></li><li><a href="global.html#getProjectedPoint">getProjectedPoint</a></li><li><a href="global.html#getStatisticsResult">getStatisticsResult</a></li><li><a href="global.html#getSupportExportFormats">getSupportExportFormats</a></li><li><a href="global.html#getWidgetFilter">getWidgetFilter</a></li><li><a href="global.html#getXYNotation">getXYNotation</a></li><li><a href="global.html#iconClass">iconClass</a></li><li><a href="global.html#iconFormat">iconFormat</a></li><li><a href="global.html#initUI">initUI</a></li><li><a href="global.html#inputError">inputError</a></li><li><a href="global.html#isAdmin">isAdmin</a></li><li><a href="global.html#isBasedOnAdmin">isBasedOnAdmin</a></li><li><a href="global.html#isBasedOnPublisher">isBasedOnPublisher</a></li><li><a href="global.html#isBasedOnUser">isBasedOnUser</a></li><li><a href="global.html#isCustom">isCustom</a></li><li><a href="global.html#isFeatureSupported">isFeatureSupported</a></li><li><a href="global.html#isPublisher">isPublisher</a></li><li><a href="global.html#isUser">isUser</a></li><li><a href="global.html#label">label</a></li><li><a href="global.html#loadAndLayout">loadAndLayout</a></li><li><a href="global.html#mapWasClicked">mapWasClicked</a></li><li><a href="global.html#name">name</a></li><li><a href="global.html#nodes">nodes</a></li><li><a href="global.html#onClose">onClose</a></li><li><a href="global.html#onExecute">onExecute</a></li><li><a href="global.html#onMinimize">onMinimize</a></li><li><a href="global.html#onNormalize">onNormalize</a></li><li><a href="global.html#parentWidget">parentWidget</a></li><li><a href="global.html#popupDidClose">popupDidClose</a></li><li><a href="global.html#postCreate">postCreate</a></li><li><a href="global.html#postMixInProperties">postMixInProperties</a></li><li><a href="global.html#print">print</a></li><li><a href="global.html#processCoordTextInput">processCoordTextInput</a></li><li><a href="global.html#profile">profile</a></li><li><a href="global.html#QRCode">QRCode</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#resize">resize</a></li><li><a href="global.html#setActions">setActions</a></li><li><a href="global.html#setCoordUI">setCoordUI</a></li><li><a href="global.html#setHidden">setHidden</a></li><li><a href="global.html#setMapLayout">setMapLayout</a></li><li><a href="global.html#setPosition">setPosition</a></li><li><a href="global.html#setPrivileges">setPrivileges</a></li><li><a href="global.html#setReportLayout">setReportLayout</a></li><li><a href="global.html#setSubCoordUI">setSubCoordUI</a></li><li><a href="global.html#setUIListeners">setUIListeners</a></li><li><a href="global.html#setVisible">setVisible</a></li><li><a href="global.html#showToolTip">showToolTip</a></li><li><a href="global.html#statInfo">statInfo</a></li><li><a href="global.html#stringify">stringify</a></li><li><a href="global.html#stringifyPretty">stringifyPretty</a></li><li><a href="global.html#stringifyPrivileges">stringifyPrivileges</a></li><li><a href="global.html#stringifyRole">stringifyRole</a></li><li><a href="global.html#updateDisplay">updateDisplay</a></li><li><a href="global.html#zoomButtonWasClicked">zoomButtonWasClicked</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Thu Dec 31 2020 13:49:27 GMT-0600 (Central Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
